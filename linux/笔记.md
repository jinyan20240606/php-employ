# 笔记

- [笔记](#笔记)
  - [注意事项](#注意事项)
  - [Linux命令常用技巧](#linux命令常用技巧)
    - [tee命令](#tee命令)
    - [EOF命令](#eof命令)
      - [EOF与管道的组合用法](#eof与管道的组合用法)


linuz终端中含内置linux命令和shell命令解析器，所以都可以执行

shell命令是个专门的脚本语言，基本的语言语法都支持，如变量、条件判断、循环、函数等


## 注意事项

1. linux中严格区分大小写

## Linux命令常用技巧

1. tab键的自动补全功能：linux系统自带的，直接按tab键即可
   1. 存在单一的目标路径：一次tab即可
   2. 多个的话：需要双击tab键，会提示所有的目标路径，这时在接着输入剩余的字符串继续tab匹配即可
2. `man [section] name` linux中命令手册查看器
3. vim 文件路径若不存在会自动新建文件
4. which：查看执行命令的路径，也可查看软件包是否安装成功
5. whereis：查看软件包的安装路径，会带上隐藏文件
6. history：查看历史执行过的命令
7. `netstat -tunpl` 是一个在 Linux 系统显示网络连接、路由表、接口统计、伪装连接和多播成员资格
   1. -t：显示TCP端口（T代表TCP）。
   2. -u：显示UDP端口（U代表UDP）。
   3. -n：显示数字形式的地址和端口号，而不是尝试确定主机名和服务名（加快查询速度，因为不需要DNS解析）。
   4. -p：显示与每个连接相关的程序的PID和名称。你需要有足够权限（通常是root）来获取此信息。
   5. -l：仅显示监听的端口/套接字
   6. 结果字段解释
      1. Proto：协议（TCP或UDP）。
      2. Recv-Q 和 Send-Q：接收队列和发送队列的大小，通常为0表示没有延迟。
      3. Local Address：本地IP地址和端口号，0.0.0.0意味着服务监听所有可用的网络接口。
      4. Foreign Address：远程IP地址和端口号，在监听状态下通常为*:*。
      5. State：状态，对于监听中的TCP连接通常是LISTEN。
      6. PID/Program name：进程ID及其对应的程序名称。
8. telnet命令工具测试与本地主机（127.0.0.1）的 6060 端口 是否建立 TCP 连接，也可以发送数据
9. pkill php： 会杀死所有进程名中包含 php 的进程
10. 命令替换符：执行括号或反引号内的命令，并将其标准输出替换到当前位置
    1.  `$(command)` 支持嵌套 或 `` `command` ``不支持嵌套
```js
// 1使用
echo "当前目录有 $(ls | wc -l) 个文件"

// 2嵌套使用
先通过pidof找nginx的PID，再通过ls -l /proc/PID/exe找启动路径，最后用dirname提取目录
nginx_dir=$(dirname $(readlink /proc/$(pidof nginx)/exe))
echo "nginx安装目录：$nginx_dir"
```
11. 变量替换符：在linuxshell中使用变量
```js
name="Alice"
echo "Hello, ${name}s" 
```
12. kill	必须通过进程 ID（PID） 指定	向单个 PID 发送信号，精确终止单个进程，kill 1234（终止 PID 为 1234 的进程）
    1.  pkill	通过进程名（或属性） 指定	批量匹配并终止符合条件的所有进程	pkill redis（终止所有名称含 redis 的进程）
13. 使用FindStr：Windows自带了一个名为findstr的工具，它可以在文件中搜索字符串，并提供了一些与grep相似的功能
16. 服务命令  
    1. service 命令：linux中用于管理系统服务，如启动、停止、重启、状态查询等。
       1. 适用于 CentOS 6 或旧版 Ubuntu
    2. systemctl 命令：linux中用于管理系统服务，如启动、停止、重启、状态查询等。
       1. 适用于 CentOS 7+/Ubuntu 16.04+ 等
    3. netstat 命令：linux中用于显示 网络连接、路由表、接口统计等网络相关信息。
       1. netstat -tunlp | grep :端口号  # 查看指定端口的进程
          1. -t：仅显示 TCP 协议相关的连接 / 端口，-u：仅显示 UDP 协议相关的连接 / 端口 ，-n：以数字形式显示 IP 地址和端口号（不进行域名解析，速度更快），-l：仅显示处于「监听状态」（LISTEN）的端口（这些端口通常是服务等待连接的端口），-p：显示每个端口对应的进程 ID（PID）和进程名称（需要 root 权限，否则可能显示 Permission denied
    4. ps：linux中用于查看当前系统中正在运行的进程
       1. ps -ef --forest：查看进程树
    5. net命令：windows中管理网络环境、服务、用户、登录等相关操作
 17. `hostnamectl set-hostname xxxx` 是 Linux 系统中用于永久修改主机名的命令，非常适合在多机环境（如Kubernetes 集群、分布式服务）中统一管理主机标识。
     1.  hostnamectl：是 systemd 系统中管理主机名的工具
 18. wget命令：下载文件到本地，保存到当前工作目录中，文件名与远程文件保持一致
     1.  -o参数：用于指定日志文件，将命令执行过程中的日志信息（如下载进度、状态提示等）输出到指定文件，而不是默认显示在终端上
 
### tee命令
`tee [选项] 文件名`

名字来源于 “T 型管道” 的形象 —— 它能像 T 字管道一样，将输入的内容同时 “分流” 到两个地方：一个文件和标准输出（屏幕）

- 作用：从标准输入（键盘或管道输入）读取内容，并同时执行两个操作：
  - 将内容输出到指定文件（这里是 /etc/docker/daemon.json）；
  - 将内容显示到屏幕（终端）。
  - 相比 echo "内容" > 文件名，tee 的优势是可以同时写入文件和显示内容，且支持通过 sudo 正确赋予文件权限（echo 配合 sudo 有时会因权限问题失败）
  - 切记：不能直接将要写的文本作为参数执行如`tee 内容 文件名`or`tee 文件名 内容`

常用法：
1. 举例：`tee test.txt` 此时输入任意内容（比如 hello tee），按回车后，内容会同时显示在屏幕上，并写入 test.txt 文件中
2. `echo "共享内容" | tee file1.txt file2.txt file3.txt`
3. `sudo tee /etc/test.txt <<-'EOF' 这是要写入的文本 EOF`

### EOF命令

- 在 Linux Shell 中，<<-'EOF' 和 EOF 组合使用的语法称为 Here Document（ heredoc，嵌入文档）
- 用于在命令行或脚本中直接定义带格式的多行文本内容，无需手动创建文件再编辑。
  - 具备标准输出的功能，跟管道符类似
  - 该语法可以保留换行符，种语法特别适合生成配置文件、批量输入文本等场景

```shell
// 它的作用是：通过 <<-'EOF' ... EOF 结构，将中间的文本内容作为标准输入传递给 tee，而不是作为命令参数

// 示例
sudo tee /etc/test.txt <<-'EOF'
这是要写入的文本
第二行内容
EOF
```

#### EOF与管道的组合用法
- EOF的开始符后面可以直接跟管道的完整命令，回车后进入EOF输入结束即可管道成功
```SHELL
cat <<EOF | sudo tee /etc/modules-load.d/k8s.conf
br_netfilter
overlay
EOF
```
